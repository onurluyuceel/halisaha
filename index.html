<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Halı Saha Ligi</title>
    <style>
        /* GENEL TASARIM */
        body { margin: 0; padding: 0; font-family: 'Segoe UI', sans-serif; background-color: #121212; color: white; padding-bottom: 80px; }
        
        /* NAVİGASYON */
        .navbar { display: flex; justify-content: center; background: #1e1e1e; padding: 15px; border-bottom: 2px solid #333; position: sticky; top: 0; z-index: 100; }
        .nav-btn { background: none; border: none; color: #aaa; font-size: 0.9rem; margin: 0 10px; cursor: pointer; padding: 5px; transition: 0.3s; }
        .nav-btn.active { color: #4caf50; border-bottom: 2px solid #4caf50; font-weight: bold; }

        .page-section { display: none; padding: 10px; max-width: 600px; margin: 0 auto; }
        .active-section { display: block; }

        /* MAÇ OLUŞTURUCU STİLLERİ */
        .builder-box { background: #1e1e1e; padding: 15px; border-radius: 10px; border: 1px solid #333; margin-bottom: 20px; }
        .input-row { display: flex; gap: 10px; margin-bottom: 10px; }
        .input-row input, .input-row select { flex: 1; padding: 8px; background: #333; color: white; border: 1px solid #555; border-radius: 4px; }
        
        /* SAHA VE DİZİLİŞ */
        .pitch-builder {
            width: 100%; height: 500px;
            background: linear-gradient(to bottom, #2e7d32, #388e3c);
            border: 2px solid rgba(255,255,255,0.3);
            border-radius: 8px; position: relative;
            display: flex; flex-direction: column; justify-content: space-evenly;
            padding: 10px 0;
            margin-top: 10px;
        }
        
        .formation-row { display: flex; justify-content: center; gap: 15px; width: 100%; z-index: 2; }

        /* OYUNCU SLOTU (Yuvarlak) */
        .player-slot {
            width: 55px; height: 85px; /* Kart boyutu */
            display: flex; flex-direction: column; align-items: center;
            cursor: pointer; position: relative;
        }
        
        .slot-circle {
            width: 45px; height: 45px; border-radius: 50%;
            background: rgba(0,0,0,0.3); border: 2px dashed rgba(255,255,255,0.5);
            display: flex; align-items: center; justify-content: center;
            font-size: 1.5rem; color: rgba(255,255,255,0.5); overflow: hidden;
        }
        
        .slot-circle img { width: 100%; height: 100%; object-fit: cover; }
        .slot-circle.filled { border: 2px solid white; background: #fff; }
        
        .slot-name { font-size: 0.65rem; background: rgba(0,0,0,0.7); padding: 1px 4px; border-radius: 3px; margin-top: -5px; z-index: 3; text-align: center; max-width: 60px; white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }

        /* GOL / ASİST GİRİŞİ */
        .stats-inputs { display: flex; gap: 2px; margin-top: 2px; }
        .stat-box { width: 20px; font-size: 0.6rem; text-align: center; border: none; border-radius: 2px; }
        .stat-g { background: #27ae60; color: white; } /* Yeşil: Gol */
        .stat-a { background: #f39c12; color: white; } /* Turuncu: Asist */

        /* MODAL (OYUNCU SEÇİM EKRANI) */
        #player-modal {
            display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%;
            background: rgba(0,0,0,0.9); z-index: 200; align-items: center; justify-content: center;
        }
        .modal-content { background: #222; padding: 20px; border-radius: 10px; width: 80%; max-height: 70%; overflow-y: auto; text-align: center; }
        .modal-player-item { padding: 10px; border-bottom: 1px solid #444; cursor: pointer; display: flex; align-items: center; gap: 10px; }
        .modal-player-item:hover { background: #333; }
        .modal-close { background: #c0392b; color: white; padding: 5px 10px; border: none; border-radius: 5px; margin-bottom: 10px; cursor: pointer; }

        /* JSON ÇIKTI ALANI */
        #json-output { width: 100%; height: 100px; background: #000; color: #4caf50; font-family: monospace; font-size: 0.8rem; border: 1px solid #333; margin-top: 10px; display: none; }
        .copy-btn { background: #4caf50; color: white; border: none; padding: 10px; width: 100%; cursor: pointer; font-weight: bold; margin-top: 5px; display: none;}

        /* GENEL BUTONLAR */
        .action-btn { background: #2980b9; color: white; border: none; padding: 10px; width: 100%; border-radius: 5px; cursor: pointer; font-weight: bold; margin-top: 10px; }
        .admin-only { display: none; } /* Sadece admin görecek */
    </style>
</head>
<body>

    <div class="navbar">
        <button class="nav-btn active" onclick="showPage('home')">MAÇLAR</button>
        <button class="nav-btn" onclick="showPage('create')">YENİ MAÇ EKLE</button>
        <button class="nav-btn" onclick="showPage('players')">OYUNCULAR</button>
    </div>

    <div id="home" class="page-section active-section">
        <h2>Oynanan Maçlar</h2>
        <div id="match-list" style="text-align: center; color: #888;">Yükleniyor...</div>
    </div>

    <div id="create" class="page-section">
        <div id="login-warning" style="text-align:center; padding:50px;">
            <h3>Yönetici Girişi Gerekli</h3>
            <p>Maç eklemek için giriş yapmalısın.</p>
            <button onclick="adminLogin()" class="action-btn">GİRİŞ YAP</button>
        </div>

        <div id="builder-interface" class="admin-only">
            <h3>Yeni Maç Oluştur</h3>
            
            <div class="builder-box">
                <div class="input-row">
                    <input type="text" id="match-date" placeholder="Tarih (Örn: 02.02.2024)">
                    <input type="text" id="match-score" placeholder="Skor (Örn: 5-3)">
                </div>
            </div>

            <div class="builder-box">
                <h4>A Takımı (Kırmızı)</h4>
                <select id="formation-a" onchange="renderFormation('pitch-a', 'teamA', this.value)">
                    <option value="3-3-1">Diziliş: 3-3-1</option>
                    <option value="3-2-2">Diziliş: 3-2-2</option>
                    <option value="2-3-2">Diziliş: 2-3-2</option>
                    <option value="2-4-1">Diziliş: 2-4-1</option>
                </select>
                <div id="pitch-a" class="pitch-builder"></div>
            </div>

            <div class="builder-box">
                <h4>B Takımı (Mavi)</h4>
                <select id="formation-b" onchange="renderFormation('pitch-b', 'teamB', this.value)">
                    <option value="3-3-1">Diziliş: 3-3-1</option>
                    <option value="3-2-2">Diziliş: 3-2-2</option>
                    <option value="2-3-2">Diziliş: 2-3-2</option>
                    <option value="2-4-1">Diziliş: 2-4-1</option>
                </select>
                <div id="pitch-b" class="pitch-builder"></div>
            </div>

            <button class="action-btn" onclick="generateMatchJSON()">MAÇI KAYDET (JSON OLUŞTUR)</button>
            <textarea id="json-output"></textarea>
            <button id="copy-btn" class="copy-btn" onclick="copyToClipboard()">KOPYALA</button>
            <p style="font-size:0.7rem; color:#888; text-align:center;">Kodu kopyalayıp GitHub'daki matches.json dosyasına yapıştır.</p>
        </div>
    </div>

    <div id="players" class="page-section">
        <h2>Oyuncu Veritabanı</h2>
        <div id="players-list-display"></div>
    </div>

    <div id="player-modal">
        <div class="modal-content">
            <button class="modal-close" onclick="closeModal()">İptal</button>
            <h3>Oyuncu Seç</h3>
            <div id="modal-list"></div>
        </div>
    </div>

    <script>
        // GLOBAL DEĞİŞKENLER
        let allPlayers = [];
        let allMatches = [];
        let currentTeam = ''; // teamA veya teamB
        let currentSlotIndex = -1; // Hangi boşluğa tıklandı
        
        // MAÇ VERİSİNİ TUTTUĞUMUZ YER (Temporary State)
        let matchData = {
            teamA: [], // {playerId: 1, g:0, a:0}
            teamB: []
        };

        // 1. VERİLERİ ÇEK
        Promise.all([
            fetch('players.json').then(r => r.json()),
            fetch('matches.json').then(r => r.json())
        ]).then(([players, matches]) => {
            allPlayers = players;
            allMatches = matches;
            
            // Oyuncu listesini göster (Basit liste)
            renderPlayerList(players);
            
            // Maçları listele
            renderMatches(matches);

            // Başlangıç sahalarını çiz
            renderFormation('pitch-a', 'teamA', '3-3-1');
            renderFormation('pitch-b', 'teamB', '3-3-1');
        });

        // 2. DİZİLİŞ MANTIĞI
        const formations = {
            '3-3-1': [1, 3, 3, 1], // Kaleci, Defans, Orta, Forvet
            '3-2-2': [1, 3, 2, 2],
            '2-3-2': [1, 2, 3, 2],
            '2-4-1': [1, 2, 4, 1]
        };

        function renderFormation(containerId, teamKey, formationCode) {
            const container = document.getElementById(containerId);
            container.innerHTML = ''; // Temizle
            
            // Diziliş satırlarını al (Örn: [1, 3, 3, 1])
            const rows = formations[formationCode];
            
            let slotCounter = 0;

            rows.forEach(count => {
                const rowDiv = document.createElement('div');
                rowDiv.className = 'formation-row';
                
                for(let i=0; i<count; i++) {
                    // Mevcut slotta oyuncu var mı kontrol et
                    const playerIndex = slotCounter;
                    const playerData = matchData[teamKey][playerIndex];
                    
                    let innerHTML = `<div class="slot-circle">+</div><div class="slot-name">Boş</div>`;
                    
                    // Eğer oyuncu seçildiyse:
                    if(playerData) {
                        const pInfo = allPlayers.find(p => p.id === playerData.playerId);
                        if(pInfo) {
                            innerHTML = `
                                <div class="slot-circle filled">
                                    <img src="${pInfo.image}">
                                </div>
                                <div class="slot-name">${pInfo.name}</div>
                                <div class="stats-inputs" onclick="event.stopPropagation()">
                                    <input type="number" class="stat-box stat-g" placeholder="G" value="${playerData.g}" onchange="updateStat('${teamKey}', ${playerIndex}, 'g', this.value)">
                                    <input type="number" class="stat-box stat-a" placeholder="A" value="${playerData.a}" onchange="updateStat('${teamKey}', ${playerIndex}, 'a', this.value)">
                                </div>
                            `;
                        }
                    }

                    const slotDiv = document.createElement('div');
                    slotDiv.className = 'player-slot';
                    slotDiv.innerHTML = innerHTML;
                    slotDiv.onclick = () => openPlayerPicker(teamKey, playerIndex);
                    
                    rowDiv.appendChild(slotDiv);
                    slotCounter++;
                }
                container.appendChild(rowDiv);
            });
            
            // State'i genişlet (Eğer yeni diziliş daha kalabalıksa array patlamasın)
            // matchData[teamKey] arrayini slot sayısı kadar null ile doldurabiliriz ama şimdilik dinamik bırakalım.
        }

        // 3. OYUNCU SEÇME İŞLEMLERİ
        function openPlayerPicker(team, index) {
            currentTeam = team;
            currentSlotIndex = index;
            
            const modal = document.getElementById('player-modal');
            const list = document.getElementById('modal-list');
            list.innerHTML = '';

            allPlayers.forEach(p => {
                const item = document.createElement('div');
                item.className = 'modal-player-item';
                item.innerHTML = `<img src="${p.image}" style="width:30px;height:30px;border-radius:50%"> ${p.name} (${p.position})`;
                item.onclick = () => selectPlayer(p.id);
                list.appendChild(item);
            });

            modal.style.display = 'flex';
        }

        function selectPlayer(id) {
            // Veriyi kaydet
            matchData[currentTeam][currentSlotIndex] = {
                playerId: id,
                g: 0,
                a: 0
            };
            
            // Sahayı güncelle
            const fmt = currentTeam === 'teamA' ? document.getElementById('formation-a').value : document.getElementById('formation-b').value;
            const divId = currentTeam === 'teamA' ? 'pitch-a' : 'pitch-b';
            
            renderFormation(divId, currentTeam, fmt);
            closeModal();
        }

        function updateStat(team, index, type, value) {
            if(matchData[team][index]) {
                matchData[team][index][type] = parseInt(value) || 0;
            }
        }

        function closeModal() {
            document.getElementById('player-modal').style.display = 'none';
        }

        // 4. JSON OLUŞTURMA (GENERATE)
        function generateMatchJSON() {
            const date = document.getElementById('match-date').value;
            const score = document.getElementById('match-score').value;
            
            if(!date || !score) { alert("Tarih ve Skor girmedin!"); return; }

            // Yeni ID hesapla (Maksimum ID + 1)
            let newId = 1;
            if(allMatches.length > 0) {
                newId = Math.max(...allMatches.map(m => m.id)) + 1;
            }

            const newMatch = {
                id: newId,
                date: date,
                score: score,
                formationA: document.getElementById('formation-a').value,
                formationB: document.getElementById('formation-b').value,
                teamA: matchData.teamA.filter(x => x), // Boş slotları temizle
                teamB: matchData.teamB.filter(x => x)
            };

            // Mevcut listeye ekle (Simülasyon)
            const updatedList = [...allMatches, newMatch];
            
            // Ekrana bas
            const output = document.getElementById('json-output');
            output.style.display = 'block';
            output.value = JSON.stringify(updatedList, null, 2); // Tüm listeyi veriyoruz ki direkt yapıştır
            
            document.getElementById('copy-btn').style.display = 'block';
            alert("JSON oluşturuldu! Kopyalayıp matches.json dosyasının tamamını bununla değiştir.");
        }

        function copyToClipboard() {
            const copyText = document.getElementById("json-output");
            copyText.select();
            document.execCommand("copy");
            alert("Kopyalandı! Şimdi GitHub'a gidip matches.json dosyasına yapıştır.");
        }

        // YARDIMCI FONKSİYONLAR
        function renderMatches(matches) {
            const list = document.getElementById('match-list');
            if(matches.length === 0) { list.innerHTML = "Henüz maç yok."; return; }
            
            let html = '';
            matches.forEach(m => {
                html += `<div style="background:#222; margin:10px; padding:10px; border-radius:5px; border-left:4px solid #4caf50;">
                    <strong>Maç #${m.id}</strong> - ${m.date} <br>
                    <span style="font-size:1.2rem; font-weight:bold;">${m.score}</span>
                </div>`;
            });
            list.innerHTML = html;
        }

        function renderPlayerList(players) {
            const div = document.getElementById('players-list-display');
            div.innerHTML = players.map(p => `<span style="display:inline-block; background:#222; padding:5px; margin:2px; border-radius:3px; font-size:0.8rem;">${p.name}</span>`).join('');
        }

        function showPage(pageId) {
            document.querySelectorAll('.page-section').forEach(p => p.classList.remove('active-section'));
            document.querySelectorAll('.nav-btn').forEach(b => b.classList.remove('active'));
            document.getElementById(pageId).classList.add('active-section');
        }

        function adminLogin() {
            const pass = prompt("Şifre:");
            if(pass === "1234") {
                document.getElementById('login-warning').style.display = 'none';
                document.getElementById('builder-interface').style.display = 'block';
                localStorage.setItem('isAdmin', true);
            }
        }
        
        if(localStorage.getItem('isAdmin')) {
            document.getElementById('login-warning').style.display = 'none';
            document.getElementById('builder-interface').style.display = 'block';
        }
    </script>
</body>
</html>
